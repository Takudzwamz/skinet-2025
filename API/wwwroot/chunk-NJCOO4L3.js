import{a as Z}from"./chunk-R6XJIFR3.js";import{B as X,C as Y,D as z,E as $,F as tt,M as et,P as rt,T as it,X as nt,w as Q}from"./chunk-F4CYNXPO.js";import{$ as P,Ea as O,Fa as M,J as N,Ka as U,La as o,M as C,Ma as a,Mb as H,Q as d,Ra as E,S as v,Sb as G,T as S,Ta as V,Ua as q,Wb as I,Yc as J,bc as K,d as f,ec as g,gb as s,hb as x,ib as D,ja as l,kb as B,lb as L,mb as W,o as m,p as A,qa as R,tb as y,ub as h,zb as T}from"./chunk-ICBD3D4S.js";var ot="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var at=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=ot[e[i]&63];return t};var _=class{id=at();items=[];deliveryMethodId;paymentReference;coupon};var w=class i{baseUrl=g.baseUrl;http=d(I);cart=P(null);itemCount=T(()=>this.cart()?.items.reduce((t,e)=>t+e.quantity,0));selectedDelivery=P(null);totals=T(()=>{let t=this.cart(),e=this.selectedDelivery();if(!t)return null;let r=t.items.reduce((b,u)=>b+u.price*u.quantity,0),n=0;t.coupon&&(console.log(t),t.coupon.amountOff?n=t.coupon.amountOff:t.coupon.percentOff&&(n=r*(t.coupon.percentOff/100)));let c=e?e.price:0,p=r+c-n;return{subtotal:r,shipping:c,discount:n,total:p}});setShippingPrice(t){return f(this,null,function*(){this.selectedDelivery.set(t);let e=this.cart();e&&(e.deliveryMethodId=t.id,yield m(this.setCart(e)))})}applyDiscount(t){return this.http.get(this.baseUrl+"coupons/"+t)}getCart(t){return this.http.get(this.baseUrl+"cart?id="+t).pipe(A(e=>(this.cart.set(e),e)))}setCart(t){return this.http.post(this.baseUrl+"cart",t).pipe(N(e=>{this.cart.set(e)}))}addItemToCart(t,e=1){return f(this,null,function*(){let r=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),r.items=this.addOrUpdateItem(r.items,t,e),yield m(this.setCart(r))})}removeItemFromCart(t,e=1){return f(this,null,function*(){let r=this.cart();if(!r)return;let n=r.items.findIndex(c=>c.productId===t);n!==-1&&(r.items[n].quantity>e?r.items[n].quantity-=e:r.items.splice(n,1),r.items.length===0?this.deleteCart():yield m(this.setCart(r)))})}deleteCart(){this.http.delete(this.baseUrl+"cart?id="+this.cart()?.id).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addOrUpdateItem(t,e,r){let n=t.findIndex(c=>c.productId===e.productId);return n===-1?(e.quantity=r,t.push(e)):t[n].quantity+=r,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,pictureUrl:t.pictureUrl,brand:t.brand,type:t.type}}isProduct(t){return t.id!==void 0}createCart(){let t=new _;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(e){return new(e||i)};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};var k=class i{http=d(I);baseUrl=g.baseUrl;createOrUpdatePaymentTransaction(t){return this.http.post(this.baseUrl+"payments/"+t,{})}payWithPaystack(t){let e={key:g.paystackPublicKey,email:t.email,amount:t.amount*100,ref:t.ref,currency:"ZAR",onClose:t.onClose,callback:t.onSuccess};PaystackPop.setup(e).openIframe()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};function lt(i,t){i&1&&(o(0,"div",13)(1,"button",21),s(2,"Checkout"),a(),o(3,"button",22),s(4,"Continue Shopping"),a()())}function mt(i,t){if(i&1){let e=E();o(0,"div",17)(1,"span",23),s(2),a(),o(3,"button",24),V("click",function(){v(e);let n=q();return S(n.removeCouponCode())}),o(4,"mat-icon",25),s(5,"delete"),a()()()}i&2&&(l(2),D("",t.name," applied"))}var ct=class i{cartService=d(w);paystackService=d(k);location=d(H);code;applyCouponCode(){this.code&&this.cartService.applyDiscount(this.code).subscribe({next:t=>f(this,null,function*(){let e=this.cartService.cart();e&&(e.coupon=t,yield m(this.cartService.setCart(e)),this.code=void 0,this.location.path().includes("/checkout")&&(yield m(this.paystackService.createOrUpdatePaymentTransaction(e.id))))})})}removeCouponCode(){return f(this,null,function*(){let t=this.cartService.cart();t?.coupon&&(t.coupon=void 0,yield m(this.cartService.setCart(t)),this.location.path().includes("/checkout")&&(yield m(this.paystackService.createOrUpdatePaymentTransaction(t.id))))})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=R({type:i,selectors:[["app-order-summary"]],decls:43,vars:17,consts:[["form","ngForm"],[1,"mx-auto","max-w-4xl","flex-1","space-y-6","w-full"],[1,"space-y-4","rounded-lg","border","border-gray-200","bg-white","p-4","shadow-sm"],[1,"text-xl","font-semibold"],[1,"space-y-4"],[1,"space-y-2"],[1,"flex","items-center","justify-between","gap-4"],[1,"font-medium","text-gray-500"],[1,"font-medium","text-gray-900"],[1,"font-medium","text-green-500"],[1,"flex","items-center","justify-between","gap-4","border-t","border-gray-200","pt-2"],[1,"font-bold","text-gray-900"],[1,"font-semibold","text-gray-900"],[1,"flex","flex-col","gap-2"],[1,"space-y-4","rounded-lg","border","border-gray-200","bg-white","shadow-sm"],[1,"space-y-2","flex","flex-col","p-2",3,"ngSubmit"],[1,"mb-2","block","text-sm","font-medium"],[1,"flex","justify-between","items-center"],["appearance","outline"],["name","code","type","text","matInput","",3,"ngModelChange","disabled","ngModel"],["type","submit","mat-flat-button","",3,"disabled"],["routerLink","/checkout","mat-flat-button",""],["routerLink","/shop","mat-button",""],[1,"text-sm","font-semibold"],["mat-icon-button","",3,"click"],["color","warn"]],template:function(e,r){if(e&1){let n=E();o(0,"div",1)(1,"div",2)(2,"p",3),s(3,"Order summary"),a(),o(4,"div",4)(5,"div",5)(6,"dl",6)(7,"dt",7),s(8,"Subtotal"),a(),o(9,"dd",8),s(10),y(11,"currency"),a()(),o(12,"dl",6)(13,"dt",7),s(14,"Discount"),a(),o(15,"dd",9),s(16),y(17,"currency"),a()(),o(18,"dl",6)(19,"dt",7),s(20,"Delivery fee"),a(),o(21,"dd",8),s(22),y(23,"currency"),a()()(),o(24,"dl",10)(25,"dt",11),s(26,"Total"),a(),o(27,"dd",12),s(28),y(29,"currency"),a()()(),O(30,lt,5,0,"div",13),a(),o(31,"div",14)(32,"form",15,0),V("ngSubmit",function(){return v(n),S(r.applyCouponCode())}),o(34,"label",16),s(35,"Do you have a voucher code?"),a(),O(36,mt,6,1,"div",17),o(37,"mat-form-field",18)(38,"mat-label"),s(39,"Voucher code"),a(),o(40,"input",19),W("ngModelChange",function(p){return v(n),L(r.code,p)||(r.code=p),S(p)}),a()(),o(41,"button",20),s(42,"Apply code"),a()()()()}if(e&2){let n,c,p,b,u,F,j;l(10),x(h(11,9,(n=r.cartService.totals())==null?null:n.subtotal)),l(6),D(" -",h(17,11,(c=r.cartService.totals())==null?null:c.discount)),l(6),x(h(23,13,(p=r.cartService.totals())==null?null:p.shipping)),l(6),x(h(29,15,(b=r.cartService.totals())==null?null:b.total)),l(2),M(r.location.path()!=="/checkout"?30:-1),l(6),M((u=(u=r.cartService.cart())==null?null:u.coupon)?36:-1,u),l(4),U("disabled",!!((F=r.cartService.cart())!=null&&F.coupon)),B("ngModel",r.code),l(),U("disabled",!!((j=r.cartService.cart())!=null&&j.coupon))}},dependencies:[it,rt,J,K,nt,G,et,tt,Q,X,Y,$,z,Z],encapsulation:2})};export{w as a,k as b,ct as c};
